#!/bin/sh

screen_blank () {
  xset dpms force off
}

set_wallpaper () {
  hsetroot -tile "$1"
}

screenshot () {
  ffmpeg -f x11grab -video_size 1600x900 -i $DISPLAY -vframes 1 $HOME/usr/img/$(echo $(date "+%m%d%H%M%S"))screen.png
}

battery_status () {
  dir=/sys/class/power_supply
  bat0_charge=$(cat $dir/BAT0/capacity)
  bat0_status=$(cat $dir/BAT0/status)
  bat1_charge=$(cat $dir/BAT1/capacity)
  bat1_status=$(cat $dir/BAT1/status)

  echo "Main battery:\n  Charge: ${bat0_charge}%\n  Status: ${bat0_status}\nReplaceable battery:\n  Charge: ${bat1_charge}%\n  Status: ${bat1_status}"
}

toggle_touchpad () {
  name="SynPS/2 Synaptics TouchPad"
  state=$(xinput list-props "$name" | sed '2q;d' | awk '{print $4}')
  if [ $state = 0 ];then
    xinput enable "$name"
    echo "Enabled touchpad"
  else
    xinput disable "$name"
    echo "Disabled touchpad"
  fi
}

toggle_dpms () {
  # State is either 'Enabled' or 'Disabled'
  state=$(xset q | grep 'DPMS' | tail -1 | awk '{print $3}')
  if [ $state = 'Enabled' ];then
    xset -dpms
    echo "Disabled DPMS"
  else
    xset dpms
    echo "Enabled DPMS"
  fi
}

# Assumes the mixer is PCM and Left and Right volume levels are the same,
# other values for amixer are default. Doesn't mute channel, just sets volume to 0
toggle_mute () {
  pulsemixer --toggle-mute
}


case "$1" in
  blank) screen_blank ;;
  wall) set_wallpaper $2 ;;
  touch*) toggle_touchpad ;;
  mute) toggle_mute ;;
  dpms) toggle_dpms ;;
  batt*) battery_status;;
  screen*) screenshot ;;
  *) echo "$1 - unknown function"
esac
